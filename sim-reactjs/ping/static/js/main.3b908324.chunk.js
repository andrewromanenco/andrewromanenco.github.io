(this["webpackJsonppaxos-reactjs"]=this["webpackJsonppaxos-reactjs"]||[]).push([[0],{65:function(e,t,n){},66:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var s=n(6),i=n(0),o=n.n(i),a=n(8),r=n.n(a),c=(n(65),n(51)),l=n(29),h=n(11),u=n(12),d=n(24),f=n(17),b=n(16),k=(n(66),function(){function e(t,n){if(Object(h.a)(this,e),"string"!==typeof t&&t instanceof String)throw new Error("toName must be a string");if("string"!==typeof n&&n instanceof String)throw new Error("fromName must be a string");this.to=t,this.from=n,this.op=this.constructor.name}return Object(u.a)(e,[{key:"execute",value:function(e,t){throw new Error("Must override this method")}}]),e}()),j=function(){function e(){Object(h.a)(this,e),this.nodes=[],this.brokenLinks="[]"}return Object(u.a)(e,[{key:"registerNode",value:function(e){this.nodes.forEach((function(t){if(t.name===e.name)throw new Error("Name already registered: "+t.name)})),this.nodes.push(e)}},{key:"validateBrokenLinks",value:function(){try{var e=JSON.parse(this.brokenLinks);if(!Array.isArray(e))return console.log("Broken list must be an array of pairs"),!1;var t=!1;if(e.forEach((function(e){Array.isArray(e)||(t=!0,console.error('Elements of block list must by lists like ["A", "B"] but got '+JSON.stringify(e)))})),t)return!1}catch(n){return console.log("Bad json for broken list, must be json, e.g. '[]' for empty"),!1}return!0}},{key:"sendMessage",value:function(e){if(!(e instanceof k))throw Error("The message to send is not an instance of MessageOp: "+JSON.stringify(e));var t=JSON.parse(this.brokenLinks),n=!1;if(t.forEach((function(t){(t[0]===e.to&&t[1]===e.from||t[1]===e.to&&t[0]===e.from)&&(n=!0)})),n)console.log("Message is dropped due to block rule.");else{var s=!1;if(this.nodes.forEach((function(t){t.name===e.to&&(t.scheduleOp(e),s=!0)})),!s)throw new Error("Failed to deliver message: "+JSON.stringify(e))}}},{key:"findByRole",value:function(e,t){var n=[];if(this.nodes.forEach((function(t){t.hasRole(e)&&n.push(t)})),t)for(var s,i,o=n.length;0!==o;)i=Math.floor(Math.random()*o),s=n[o-=1],n[o]=n[i],n[i]=s;return n}},{key:"setBrokenLinks",value:function(e){this.brokenLinks=e}}]),e}(),p=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"replyReceived",value:function(){this.state.gotReply=!0}}]),n}(function(){function e(t,n){Object(h.a)(this,e),this.name=t,n?Array.isArray(n)?this.roles=n:this.roles=[n]:this.roles=[],this.queue=[],this.messageBroker=null,this.state={}}return Object(u.a)(e,[{key:"bind",value:function(e){return this.messageBroker=e,e.registerNode(this),this}},{key:"scheduleOp",value:function(e){var t=Object(l.a)(this.queue);t.push(e),this.queue=t}},{key:"scheduleOpOnTop",value:function(e){var t=Object(l.a)(this.queue);t.unshift(e),this.queue=t}},{key:"tick",value:function(e){if(!this.messageBroker)throw new Error("Message broker is not set for "+this.name);0!==this.queue.length&&this.queue.shift().execute(this,e)}},{key:"hasScheduledOps",value:function(){return this.queue.length>0}},{key:"hasRole",value:function(e){return this.roles.includes(e)}}]),e}()),g=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"execute",value:function(e,t){console.log("Got ping back!"),e.replyReceived()}}]),n}(k),O=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"execute",value:function(e,t){console.log("Got a ping request, sending back a reply"),e.messageBroker.sendMessage(new g(this.from,e.name))}}]),n}(k),m=function(){function e(t,n,s,i){Object(h.a)(this,e),this.tickToWait=t,this.waitConditionFn=n,this.timeoutFn=s,this.label=i,this.op=this.constructor.name}return Object(u.a)(e,[{key:"execute",value:function(e,t){if(this.waitConditionFn(e))console.log("Condition met in "+this.label);else{if(t<this.tickToWait)return console.log("Still waiting"),void e.scheduleOp(this);console.log("Timed out: "+this.label),this.timeoutFn(e)}}}]),e}(),v=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"execute",value:function(e,t){console.log("Executing "+this.op+" and sending ping to "+this.to),e.messageBroker.sendMessage(new O(this.to,e.name));var n=new m(t+10,(function(e){return e.state.gotReply}),(function(e){e.state.timedOut=!0}),"Wait for reply");e.scheduleOp(n)}}]),n}(k),y=function(){function e(){Object(h.a)(this,e)}return Object(u.a)(e,[{key:"create",value:function(e){var t=new p("A"),n=new p("B");t.bind(e),n.bind(e),t.scheduleOp(new v("B"))}},{key:"controlUI",value:function(){return Object(s.jsxs)("div",{children:[Object(s.jsx)("h1",{children:"PING"}),Object(s.jsx)("div",{children:"Open debug console to see log message. Keep clicking Tick for step-by-step progress."}),Object(s.jsx)("div",{children:"To simulate a delay, use form below to add 12 ticks of sleep to B and keep ticking."})]})}}]),e}(),x=n(112),S=n(116),w=n(115),T=n(111),B=n(113),C=n(114),N=n(107),E=n(120),L=n(121),A=n(119),q=function(){function e(t){Object(h.a)(this,e),this.sleep=t}return Object(u.a)(e,[{key:"execute",value:function(t,n){this.sleep>1?(console.log("Still sleeping for "+(this.sleep-1)),t.scheduleOpOnTop(new e(this.sleep-1))):console.log("Slept enough")}}]),e}(),J=function(e){Object(f.a)(n,e);var t=Object(b.a)(n);function n(e){var s;if(Object(h.a)(this,n),(s=t.call(this,e)).messageBroker=new j,s.example=new y,s.example.create(s.messageBroker),0===s.messageBroker.nodes.length)throw new Error("No nodes to work with");return s.state={nodes:Object(l.a)(s.messageBroker.nodes),tick:1,brokenLinks:"[]",sleepTicks:"0",nodeToSleep:s.messageBroker.nodes[0].name},s.tick=s.tick.bind(Object(d.a)(s)),s.handleBrokenLinksChange=s.handleBrokenLinksChange.bind(Object(d.a)(s)),s.handleSleepTicksChange=s.handleSleepTicksChange.bind(Object(d.a)(s)),s.handleNodeToSleepChange=s.handleNodeToSleepChange.bind(Object(d.a)(s)),s.addSleepToNode=s.addSleepToNode.bind(Object(d.a)(s)),s}return Object(u.a)(n,[{key:"tick",value:function(){var e=this;if(this.messageBroker.validateBrokenLinks()){console.log("Start with tick "+this.state.tick);var t=[];this.state.nodes.forEach((function(e){e.hasScheduledOps()&&t.push(e)})),t.forEach((function(t){console.log("Tick on "+t.name),t.tick(e.state.tick)})),console.log("Done with tick "+this.state.tick),console.log("------------------------");var n=this.state.tick+1,s=Object(l.a)(this.messageBroker.nodes);this.setState({tick:n,nodes:s})}}},{key:"addSleepToNode",value:function(){var e=this;this.state.nodes.forEach((function(t){t.name===e.state.nodeToSleep&&(console.log("Added sleep to "+t.name),t.scheduleOpOnTop(new q(parseInt(e.state.sleepTicks))))})),this.setState({nodes:Object(l.a)(this.state.nodes)})}},{key:"handleBrokenLinksChange",value:function(e){this.messageBroker.setBrokenLinks(e.target.value),this.setState({brokenLinks:e.target.value})}},{key:"handleSleepTicksChange",value:function(e){this.setState({sleepTicks:e.target.value})}},{key:"handleNodeToSleepChange",value:function(e){this.setState({nodeToSleep:e.target.value})}},{key:"render",value:function(){return Object(s.jsxs)("div",{children:[this.example.controlUI(),Object(s.jsxs)(N.a,{variant:"contained",onClick:this.tick,children:["Tick (",this.state.tick,")"]}),Object(s.jsx)("br",{}),Object(s.jsx)(T.a,{children:Object(s.jsxs)(x.a,{"aria-label":"simple table",children:[Object(s.jsx)(B.a,{children:Object(s.jsxs)(C.a,{children:[Object(s.jsx)(w.a,{children:"Node name"}),Object(s.jsx)(w.a,{children:"Incoming queue"}),Object(s.jsx)(w.a,{children:"State"})]})}),Object(s.jsx)(S.a,{children:this.state.nodes.map((function(e){return Object(s.jsxs)(C.a,{children:[Object(s.jsx)(w.a,{children:e.name}),Object(s.jsx)(w.a,{children:e.queue.map((function(t,n){return Object(s.jsx)("div",{children:JSON.stringify(t)},e.name+t.op+n)}))}),Object(s.jsx)(w.a,{children:Object.entries(e.state).map((function(t){var n=Object(c.a)(t,2),i=n[0],o=n[1];return Object(s.jsx)("div",{children:Object(s.jsxs)("pre",{children:[i,": ",JSON.stringify(o,null,2)]})},e.name+i)}))})]},e.name)}))})]})}),Object(s.jsx)(E.a,{label:'Json list of pairs of broken list. E.g. [["A", "B"], ["A", "C"]] messages b/n A<->B and A<->C will be dropped.',value:this.state.brokenLinks,onChange:this.handleBrokenLinksChange,multiline:!0,fullWidth:!0,rows:"10"}),Object(s.jsx)("br",{}),Object(s.jsx)(E.a,{label:"Sleep length in ticks",value:this.state.sleepTicks,onChange:this.handleSleepTicksChange,multiline:!1,fullWidth:!1,rows:"1"}),Object(s.jsx)(A.a,{value:this.state.nodeToSleep,onChange:this.handleNodeToSleepChange,children:this.state.nodes.map((function(e){return Object(s.jsx)(L.a,{value:e.name,children:e.name},e.name)}))}),Object(s.jsxs)(N.a,{variant:"contained",onClick:this.addSleepToNode,children:["Add sleep to ",this.state.nodeToSleep]}),Object(s.jsx)("br",{})]})}}]),n}(o.a.Component),M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,123)).then((function(t){var n=t.getCLS,s=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),s(e),i(e),o(e),a(e)}))};r.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(J,{})}),document.getElementById("root")),M()}},[[70,1,2]]]);
//# sourceMappingURL=main.3b908324.chunk.js.map